<!-- Transcribe Controls -->
<div id="transcribe-area">
  <!-- IDLE STATE -->
  <div class="voiceui-idle-view">
    <div class="voiceui-recorder-ui">
      <div class="voiceui-recorder-viz">
        <canvas id="recorder-canvas"></canvas>
        <div class="voiceui-recorder-timer">00:00</div>
      </div>
      <div class="voiceui-recorder-actions">
        <button class="voiceui-recorder-btn" id="record-btn" title="单击或按住空格键开始/停止录音">
          <span class="idle-content">
            <div class="btn-text-stack">
              <span class="btn-text-main">开始录音</span>
              <span class="btn-text-sub">SPACE</span>
            </div>
          </span>
          <span class="recording-content">
            <span class="btn-text-main">停止</span>
          </span>
        </button>
        <button class="voiceui-recorder-btn voiceui-transcribe-now-btn" id="transcribe-now-btn" title="完成并立即开始识别">
          <span class="btn-text-main">识别</span>
        </button>
        <button class="voiceui-recorder-btn voiceui-cancel-btn" id="cancel-record-btn" title="取消录音">
          <span class="btn-text-main">取消</span>
        </button>
      </div>
    </div>
    <div class="voiceui-upload-prompt">
      <div class="voiceui-upload-line">
          <span>或者 <button type="button" class="voiceui-link-button" id="upload-link-btn">上传文件</button></span>
          <div class="voiceui-tooltip-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" class="voiceui-help-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <div class="voiceui-tooltip-content">支持的音频/视频格式: aac, amr, avi, aiff, flac, flv, m4a, mkv, mp3, mp4, mpeg, ogg, opus, wav, webm, wma, wmv</div>
          </div>
      </div>
      <small>支持拖拽上传，文件不超过 10MB</small>
      <input type="file" id="file-input" style="display: none;" />
    </div>
  </div>
  
  <!-- LOADING STATE -->
  <div class="voiceui-loading-view">
    <div class="voiceui-spinner"></div>
    <div class="voiceui-loading-text-group">
      <span class="voiceui-loading-filename"></span>
      <span>正在识别...</span>
      <span class="voiceui-loading-timer">0.0s</span>
    </div>
  </div>

  <!-- ERROR STATE -->
  <div class="voiceui-error-view">
     <svg class="icon error-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
     <span class="voiceui-panel-error-message"></span>
     <button class="voiceui-panel-action-btn" id="retry-btn">重试</button>
  </div>

  <!-- PREVIEW STATE -->
  <div class="voiceui-preview-view">
    <p class="voiceui-preview-header">音频预览</p>
    <div class="voiceui-audio-player">
      <div class="player-header">
        <div class="player-header-left">
          <span id="player-filename"></span>
          <button id="download-btn" class="player-btn" title="Download Audio">
            <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path></svg>
          </button>
        </div>
        <span id="player-timedisplay">00:00 / 00:00</span>
      </div>
      <div id="preview-waveform-container">
        <canvas id="preview-canvas"></canvas>
        <div id="playhead"></div>
      </div>
      <div class="player-controls">
        <div class="controls-left">
          <button id="volume-btn" class="player-btn" title="Mute/Unmute">
            <svg id="volume-on-icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
            <svg id="volume-off-icon" viewBox="0 0 24 24" style="display: none;"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg>
          </button>
          <button id="speed-btn" class="player-btn" title="Playback Speed">1x</button>
        </div>
        <div class="controls-center">
          <button id="rewind-btn" class="player-btn" title="Rewind 5s">
            <svg viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"></path></svg>
          </button>
          <button id="play-pause-btn" class="player-btn" title="Play/Pause">
            <svg id="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
            <svg id="pause-icon" viewBox="0 0 24 24" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
          </button>
          <button id="forward-btn" class="player-btn" title="Forward 5s">
            <svg viewBox="0 0 24 24"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"></path></svg>
          </button>
        </div>
        <div class="controls-right">
          <button id="loop-btn" class="player-btn" title="Loop">
            <svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"></path></svg>
          </button>
          <button id="trim-btn" class="player-btn disabled" title="Trim (Not implemented)">
             <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="6" cy="6" r="3"></circle><circle cx="6" cy="18" r="3"></circle><line x1="20" y1="4" x2="8.12" y2="15.88"></line><line x1="14.47" y1="14.48" x2="20" y2="20"></line><line x1="8.12" y1="8.12" x2="12" y2="12"></line></svg>
          </button>
          <button id="preview-cancel-btn" class="player-btn" title="Cancel">
            <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
          </button>
        </div>
      </div>
    </div>
    <div class="voiceui-preview-actions">
      <button class="voiceui-panel-action-btn secondary" id="preview-start-new-recording-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
        <span>开始录音</span>
      </button>
      <button class="voiceui-panel-action-btn primary" id="preview-transcribe-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12h18M13 5l7 7-7 7"/></svg>
        <span>开始转录</span>
      </button>
    </div>
  </div>

</div>

<!-- Settings -->
<details class="voiceui-settings-details" open>
  <summary class="voiceui-settings-summary">
    <span>设置</span>
    <svg class="chevron-icon" viewBox="0 0 20 20" fill="currentColor" width="20" height="20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
  </summary>
  <div class="voiceui-settings-content">
    <div class="voiceui-row"><label for="voiceui-provider">API 服务</label><select id="voiceui-provider">
        <option value="free">共享线路</option>
        <option value="dashscope">阿里云百炼</option>
    </select></div>
    <div class="voiceui-row" id="api-key-row"><label for="voiceui-apikey">阿里云百炼 Key</label><input type="password" id="voiceui-apikey" placeholder="sk-..." /></div>
    <div class="voiceui-row" id="dashscope-model-row">
      <label for="voiceui-dashscope-model">ASR 模型</label>
      <select id="voiceui-dashscope-model">
        <option value="qwen3-asr-flash">qwen3-asr-flash</option>
        <option value="qwen3-asr-flash-2025-09-08">qwen3-asr-flash-2025-09-08</option>
      </select>
    </div>
    <div class="voiceui-row"><label for="voiceui-lang">语言</label><select id="voiceui-lang">
        <option value="auto">🌐 自动检测</option>
        <option value="zh">🇨🇳 中文</option>
        <option value="en">🇬🇧 English</option>
        <option value="ja">🇯🇵 日本語</option>
        <option value="ko">🇰🇷 한국어</option>
        <option value="de">🇩🇪 Deutsch</option>
        <option value="ru">🇷🇺 Русский</option>
        <option value="fr">🇫🇷 Français</option>
        <option value="pt">🇵🇹 Português</option>
        <option value="ar">🇸🇦 العربية</option>
        <option value="it">🇮🇹 Italiano</option>
        <option value="es">🇪🇸 Español</option>
    </select></div>
    <div class="voiceui-row"><label for="voiceui-mic">麦克风</label><select id="voiceui-mic">
        <option value="default">默认设备</option>
    </select></div>
    <div class="voiceui-row"><label for="voiceui-itn" title="启用后，会将语音识别结果中的数字、日期、度量单位等格式化为书面语，例如将“一百块”转换为“100元”。">逆向文本标准化</label><label class="switch"><input type="checkbox" id="voiceui-itn" /><span class="slider"></span></label></div>
    <div class="voiceui-row" id="voiceui-streaming-row"><label for="voiceui-streaming" title="启用后，将实时返回识别的中间结果，减少等待时间。仅阿里云百炼服务可用。">流式输出</label><label class="switch"><input type="checkbox" id="voiceui-streaming" /><span class="slider"></span></label></div>
    <div class="voiceui-row">
      <label for="voiceui-ctx">上下文</label>
      <div class="voiceui-input-wrapper">
        <input type="text" id="voiceui-ctx" placeholder="" />
        <button type="button" id="voiceui-ctx-expand" class="voiceui-expand-btn" title="展开编辑">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display: block;">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
            <polyline points="15 3 21 3 21 9"></polyline>
            <line x1="10" y1="14" x2="21" y2="3"></line>
          </svg>
        </button>
      </div>
    </div>
    <div class="voiceui-row"><label for="voiceui-autocopy" title="启用后，识别成功的文本会自动复制到剪贴板。">自动复制</label><label class="switch"><input type="checkbox" id="voiceui-autocopy" /><span class="slider"></span></label></div>
    <div class="voiceui-row"><label for="voiceui-remove-period" title="启用后，会自动移除中文模式下句末的句号“。”。">去掉句末句号</label><label class="switch"><input type="checkbox" id="voiceui-remove-period" /><span class="slider"></span></label></div>
    <div class="voiceui-row">
      <div class="label-container">
        <label for="voiceui-openai-processing" title="启用后，会将识别后的文本发送给一个兼容OpenAI API的大语言模型进行处理。">文本后处理</label>
      </div>
      <div class="voiceui-input-container">
        <button type="button" id="voiceui-openai-config-btn" class="voiceui-config-btn">配置</button>
        <label class="switch"><input type="checkbox" id="voiceui-openai-processing" /><span class="slider"></span></label>
      </div>
    </div>
    <div class="voiceui-row">
      <div class="label-container">
        <label for="voiceui-console-control" title="启用后，会将识别后的文本发送给一个大语言模型以生成浏览器控制台命令并执行。">控制台命令</label>
      </div>
      <div class="voiceui-input-container">
        <button type="button" id="voiceui-console-config-btn" class="voiceui-config-btn">配置</button>
        <label class="switch"><input type="checkbox" id="voiceui-console-control" /><span class="slider"></span></label>
      </div>
    </div>
    <div class="voiceui-row">
      <div class="label-container">
        <label for="voiceui-speed">转录倍速</label>
        <div class="voiceui-tooltip-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" class="voiceui-help-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <div class="voiceui-tooltip-content">启用后，会在转录前对音频进行加速处理，可以节省长音频的转录时间，但可能会略微影响准确率。</div>
        </div>
      </div>
      <div class="slider-wrapper">
        <input type="range" id="voiceui-speed" min="0.5" max="3" step="0.05" value="1">
        <span id="voiceui-speed-value" class="slider-value">1.00x</span>
      </div>
    </div>
  </div>
</details>